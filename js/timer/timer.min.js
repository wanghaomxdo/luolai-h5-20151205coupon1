var TimerJS = TimerJS || {};



TimerJS.param = {container: ".timer",
                 type: "count_then_timer",
                 countdown: 5,
                 countdown_animate: "infinite zoomIn animated",
                 timer: 10,
                 timer_animate: "infinite zoomIn animated"
                };

TimerJS.timer_obj = {countdown_timer_obj: 0,
                     timer_timer_obj: 0,
                     timer_countdown_timer_obj: 0
                    };

TimerJS.starttime = 0;

TimerJS.start = function(option){
    this.param = option;
    if(this.param.type == "countdown")
    {
        this.countdown.start();
        $(this.param.container).text(this.param.countdown);
    }
    else if(this.param.type == "timer")
    {
        this.timer.start();
        $(this.param.container).text("00 : 00");
    }
    else if(this.param.type == "countdowntimer")
    {
        this.countdowntimer.start();
        $(this.param.container).text(
            (this.param.timer - 1 < 10 ? "0" + this.param.timer : this.param.timer)
             + " : 99"
        );
    }
    else if(this.param.type == "countdown_then_timer")
    {
        this.countdown.start();
        $(this.param.container).text(this.param.countdown);
    }
    else if(this.param.type == "countdown_then_countdowntimer")
    {
        this.countdown.start();
        $(this.param.container).text(this.param.countdown);
    }
};


// countdown
TimerJS.countdown = function(){};
TimerJS.countdown.callback = function(){};
TimerJS.countdown.start = function(){
    $(TimerJS.param.container).addClass(TimerJS.param.countdown_animate);
    var countdown = TimerJS.param.countdown; // countdown 5s
    TimerJS.timer_obj.countdown_timer_obj = setInterval(function(){
        countdown --;
        $(TimerJS.param.container).text(countdown);
        
        if(countdown == 0)
        {
            clearInterval(TimerJS.timer_obj.countdown_timer_obj);

            $(TimerJS.param.container).removeClass(TimerJS.param.countdown_animate);

            if(TimerJS.param.type == "countdown_then_timer")
            {
                TimerJS.timer.start();
                TimerJS.timer.callback = TimerJS.countdown_then_timer.callback;
            }
            else if(TimerJS.param.type == "countdown_then_countdowntimer")
            {
                TimerJS.countdowntimer.start();
                TimerJS.countdowntimer.callback = TimerJS.countdown_then_countdowntimer.callback;
            }else
            {
                TimerJS.countdown.callback.call();
            }

        }
    }, 1000);
};

// timer
TimerJS.timer = function(){};
TimerJS.timer.callback = function(){};
TimerJS.timer.start = function(){

    //  timer
    var timer = 0; // timer 30s = 3000ms
    var timer_s = 0; // s
    var timer_ms = 0; // ms

    TimerJS.timer_obj.timer_timer_obj = setInterval(function(){

        timer++;

        if(timer < 100)
            timer_ms++;
        else
        {
            timer = 0;
            timer_ms = 0;
            timer_s++;
        }
        
        // when 30s stop
        if(timer_s == TimerJS.param.timer)
        {
            clearInterval(TimerJS.timer_obj.timer_timer_obj);
            TimerJS.timer.callback.call();
        }

        $(TimerJS.param.container).text(
            (timer_s < 10 ? "0" + timer_s : timer_s)
            + " : " 
            + (timer_ms < 10 ? "0" + timer_ms : timer_ms)
        );

    }, 10);
};

// countdown timer
TimerJS.countdowntimer = function(){};
TimerJS.countdowntimer.callback = function(){};
TimerJS.countdowntimer.start = function(){
    //  timer
    var timer = 0;
    var timer_s = 0; // s
    var timer_ms = 0; // ms

    TimerJS.timer_obj.timer_countdown_timer_obj = setInterval(function(){

        timer = new Date().getTime() - TimerJS.starttime;
        //console.log("timer: " + timer + ", TimerJS.starttime:" + TimerJS.starttime + ", Date.getTime:" + new Date().getTime());
        
        // when 30s stop
        if(timer > 30000)
        {
            $(TimerJS.param.container).text("00:01");

            $(TimerJS.param.container).removeClass(TimerJS.param.timer_animate);

            clearInterval(TimerJS.timer_obj.timer_countdown_timer_obj);

            TimerJS.countdowntimer.callback.call();
        }else
        {

        timer_s = TimerJS.param.timer - Math.floor(timer / 1000);
        if(timer.toString().length == 4)
            timer_ms = 100 - (parseInt(timer.toString().substring(2)) == 0 ? 1 : parseInt(timer.toString().substring(2)));
        else if(timer.toString().length == 5)
            timer_ms = 100 - (parseInt(timer.toString().substring(3)) == 0 ? 1 : parseInt(timer.toString().substring(3)));

            $(TimerJS.param.container).text(
                (timer_s < 10 ? "0" + timer_s : timer_s)
                + " : " 
                + (timer_ms < 10 ? "0" + timer_ms : timer_ms)
            );
        }

    }, 10);

    TimerJS.starttime = new Date().getTime();
};

// countdowntimer
TimerJS.countdown_then_timer = function(){};
TimerJS.countdown_then_timer.callback = function(){};

// countdown_then_countdowntimer
TimerJS.countdown_then_countdowntimer = function(){};
TimerJS.countdown_then_countdowntimer.callback = function(){};

TimerJS.destory = function(){
    if(TimerJS.timer_obj.countdown_timer_obj)
        clearInterval(TimerJS.timer_obj.countdown_timer_obj);
    if(TimerJS.timer_obj.timer_timer_obj)
        clearInterval(TimerJS.timer_obj.timer_timer_obj);
    if(TimerJS.timer_obj.timer_countdown_timer_obj)
        clearInterval(TimerJS.timer_obj.timer_countdown_timer_obj);

    TimerJS.countdown.callback = function(){};
    TimerJS.timer.callback = function(){};
    TimerJS.countdowntimer.callback = function(){};
    TimerJS.countdown_then_timer.callback = function(){};
    TimerJS.countdown_then_countdowntimer.callback = function(){};
};

